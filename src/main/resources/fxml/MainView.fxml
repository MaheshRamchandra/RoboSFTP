<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.PasswordField?>
<?import javafx.scene.control.ProgressBar?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.Tab?>
<?import javafx.scene.control.TabPane?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.control.TitledPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.VBox?>

<VBox xmlns="http://javafx.com/javafx/17.0.16"
      xmlns:fx="http://javafx.com/fxml/1"
      fx:controller="org.robo.ui.UIController"
      stylesheets="@/css/styles.css"
      spacing="8">

    <padding>
        <Insets top="12" right="12" bottom="12" left="12"/>
    </padding>

    <HBox spacing="8">
        <Label text="Excel:"/>
        <TextField fx:id="tfExcel" editable="false" prefWidth="420"/>
        <Button fx:id="btnChooseExcel" text="Choose Excel"/>
    </HBox>

    <HBox spacing="8">
        <Label text="Sheet:"/>
        <ComboBox fx:id="cbSheet" prefWidth="200"/>
        <Label text="Scenario:"/>
        <ComboBox fx:id="cbScenario" prefWidth="200"/>
    </HBox>

    <HBox spacing="8">
        <Label text="Encode fields (.txt):"/>
        <TextField fx:id="tfEncode" editable="false" prefWidth="420"/>
        <Button fx:id="btnChooseEncode" text="Choose"/>
    </HBox>

    <TabPane VBox.vgrow="NEVER" prefHeight="-1" maxHeight="-1">
        <tabs>
            <Tab text="Generator" closable="false">
                <content>
                    <VBox spacing="8">
                        <padding>
                            <Insets top="8" right="8" bottom="8" left="8"/>
                        </padding>
                        <HBox spacing="8">
                            <Button fx:id="btnGenerate" text="Generate TXT" />
                            <Button fx:id="btnEncrypt" text="Encrypt (.enc)" />
                            <Label text="AES Key (hex or leave blank to use passphrase):"/>
                            <PasswordField fx:id="pfAesKey" prefWidth="200"/>
                            <Label text="Secret Key (Hex/UTF-8):"/>
                            <TextField fx:id="tfSecretKey" prefWidth="300"/>
                            <Label text="Initialization Vector (hex)"/>
                            <TextField fx:id="tfIv" prefWidth="200"/>
                        </HBox>

                        <TitledPane text="SFTP Settings (optional)" collapsible="true" expanded="false">
                            <VBox spacing="6">
                                <padding>
                                    <Insets top="8" right="8" bottom="8" left="8"/>
                                </padding>

                                <HBox spacing="8">
                                    <Label text="Host:"/>
                                    <TextField fx:id="tfHost" prefWidth="200"/>
                                    <Label text="Port:"/>
                                    <TextField fx:id="tfPort" text="22" prefWidth="80"/>
                                </HBox>
                                <HBox spacing="8">
                                    <Label text="Username:"/>
                                    <TextField fx:id="tfUser" prefWidth="200"/>
                                    <Label text="Password:"/>
                                    <PasswordField fx:id="pfPassword" prefWidth="200"/>
                                </HBox>
                                <HBox spacing="8">
                                    <Label text="Or Private Key:"/>
                                    <TextField fx:id="tfPrivateKey" editable="false" prefWidth="420"/>
                                    <Button fx:id="btnChooseKey" text="Choose Key"/>
                                </HBox>
                                <HBox spacing="8">
                                    <Label text="Remote Dir:"/>
                                    <TextField fx:id="tfRemoteDir" text="/" prefWidth="200"/>
                                    <Button fx:id="btnUpload" text="Upload"/>
                                </HBox>
                            </VBox>
                        </TitledPane>
                        <HBox spacing="8">
                            <Label text="Output Path:"/>
                            <TextField fx:id="tfOutput" editable="false" prefWidth="520"/>
                            <Button fx:id="btnOpenFolder" text="Open Folder"/>
                        </HBox>
                    </VBox>
                </content>
            </Tab>

            <Tab text="String Validation" closable="false">
                <content>
                    <ScrollPane fitToWidth="true" fitToHeight="true">
                        <content>
                            <VBox spacing="8">
                                <padding>
                                    <Insets top="8" right="8" bottom="8" left="8"/>
                                </padding>

                                <Label text="Generated String:"/>
                                <TextArea fx:id="taValidationString" prefRowCount="5" wrapText="true"/>

                                <HBox spacing="8">
                                    <Label text="Scenario name:"/>
                                    <TextField fx:id="tfValidationScenario" prefWidth="220"/>
                                </HBox>

                                <HBox spacing="8">
                                    <Label text="Search preview:"/>
                                    <TextField fx:id="tfPreviewSearch" prefWidth="320"/>
                                    <Button fx:id="btnPreviewSearch" text="Search"/>
                                </HBox>

                                <Button fx:id="btnValidateString" text="Validate &amp; Export"/>

                                <Label text="Decoded preview:"/>
                                <TextArea fx:id="taValidationPreview" prefRowCount="6" wrapText="true" editable="false"/>
                            </VBox>
                        </content>
                    </ScrollPane>
                </content>
            </Tab>

            <Tab text="RDG RAG" closable="false">
                <content>
                    <ScrollPane fitToWidth="true" fitToHeight="true">
                        <content>
                            <VBox spacing="10">
                                <padding>
                                    <Insets top="8" right="8" bottom="8" left="8"/>
                                </padding>

                                <TitledPane text="Knowledge Base" expanded="true">
                                    <content>
                                        <VBox spacing="8">
                                            <HBox spacing="8">
                                                <Label text="KB JSON:"/>
                                                <TextField fx:id="tfRagKb" editable="false" prefWidth="400"/>
                                                <Button fx:id="btnRagChooseKb" text="Choose"/>
                                                <Button fx:id="btnRagLoadSample" text="Load Sample"/>
                                            </HBox>
                                        </VBox>
                                    </content>
                                </TitledPane>

                                <TitledPane text="RDG Selection &amp; Retrieval" expanded="true">
                                    <content>
                                        <VBox spacing="8">
                                            <HBox spacing="8">
                                                <Label text="RDG:"/>
                                                <ComboBox fx:id="cbRagRdg" prefWidth="220"/>
                                                <Button fx:id="btnRagRetrieve" text="Retrieve Fields"/>
                                                <Button fx:id="btnRagGenerateSpec" text="Generate Spec"/>
                                            </HBox>
                                            <Label text="Offline JSON spec:"/>
                                            <TextArea fx:id="taRagOutput" prefRowCount="12" wrapText="true" VBox.vgrow="ALWAYS"/>
                                        </VBox>
                                    </content>
                                </TitledPane>

                                <TitledPane text="Excel writer" expanded="true">
                                    <content>
                                        <VBox spacing="8">
                                            <HBox spacing="8">
                                                <Label text="Workbook (.xlsx):"/>
                                                <TextField fx:id="tfRagWorkbook" prefWidth="320"/>
                                                <Button fx:id="btnRagChooseWorkbook" text="Choose"/>
                                            </HBox>
                                            <HBox spacing="8">
                                                <Button fx:id="btnRagWriteSheet" text="Write Sheet (Spec)"/>
                                                <Label text="Scenario count:"/>
                                                <TextField fx:id="tfRagScenarioCount" prefWidth="80" text="1"/>
                                                <Label text="Assessment tool:"/>
                                                <ComboBox fx:id="cbRagAssessmentTool" prefWidth="100"/>
                                                <Button fx:id="btnRagWriteScenarios" text="Write Sheet (RDG* data)"/>
                                            </HBox>
                                            <HBox spacing="8">
                                                <Label text="Mix (single tool, e.g. FIM:3):"/>
                                                <TextField fx:id="tfRagScenarioMix" prefWidth="240"/>
                                            </HBox>
                                            <HBox spacing="8">
                                                <Button fx:id="btnRagPreviewScenarios" text="Preview Scenarios"/>
                                                <Label text="Edit cells in the table below before saving."/>
                                                <Button fx:id="btnRagSavePreview" text="Save Preview"/>
                                                <Button fx:id="btnRagOpenPreviewWindow" text="Open Preview Window"/>
                                            </HBox>
                                            <ScrollPane fitToWidth="true" prefHeight="320" VBox.vgrow="ALWAYS">
                                                <content>
                                                    <VBox fx:id="vbRagScenarioPreviews" spacing="10" />
                                                </content>
                                            </ScrollPane>
                                        </VBox>
                                    </content>
                                </TitledPane>

                                <Label text="RAG Log:"/>
                                <TextArea fx:id="taRagLog" prefRowCount="8" wrapText="true" VBox.vgrow="ALWAYS"/>
                            </VBox>
                        </content>
                    </ScrollPane>
                </content>
            </Tab>

            <Tab text="Dependency Triggering" closable="false">
                <content>
                    <ScrollPane fitToWidth="true" fitToHeight="true">
                        <content>
                            <VBox spacing="10">
                                <padding>
                                    <Insets top="12" right="12" bottom="12" left="12"/>
                                </padding>
                                <Label text="Dependency Triggering Rules" style="-fx-font-size: 14px; -fx-font-weight: bold;"/>
                                <HBox spacing="8">
                                    <Label text="Rules JSON:"/>
                                    <TextField fx:id="tfDepRules" editable="false" prefWidth="400"/>
                                    <Button fx:id="btnDepChooseRules" text="Choose"/>
                                    <Button fx:id="btnDepLoadRules" text="Load"/>
                                </HBox>
                                <Label wrapText="true" text="Lists fields marked 'Yes (refer to rule)' and summarizes when they become mandatory vs optional based on their rule text."/>
                                <TableView fx:id="tblDepRules" prefHeight="500" VBox.vgrow="ALWAYS">
                                    <columns>
                                        <TableColumn fx:id="colDepName" text="Field" prefWidth="180"/>
                                        <TableColumn fx:id="colDepRequired" text="Required" prefWidth="140"/>
                                        <TableColumn fx:id="colDepMandatoryWhen" text="Mandatory When" prefWidth="320"/>
                                        <TableColumn fx:id="colDepOptionalWhen" text="Optional Otherwise" prefWidth="260"/>
                                        <TableColumn fx:id="colDepRule" text="Rule" prefWidth="420"/>
                                    </columns>
                                </TableView>
                            </VBox>
                        </content>
                    </ScrollPane>
                </content>
            </Tab>
        </tabs>
    </TabPane>

    <ProgressBar fx:id="progressBar" prefWidth="700" progress="0"/>

    <Label text="Log:"/>
    <TextArea fx:id="taLog" prefRowCount="8" wrapText="true"/>
    <Button fx:id="btnClearScreens" text="Clear Screens"/>

</VBox>
